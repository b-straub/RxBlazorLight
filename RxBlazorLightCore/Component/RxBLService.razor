@typeparam TService where TService : RxBLServiceBase
@inherits OwningComponentBase<TService>

<CascadingValue Value=@Service>
    <CascadingValue Value=@SampleMS>
        <CascadingValue Value=@ServiceInitialized>
            @ChildContent
        </CascadingValue>
    </CascadingValue>
</CascadingValue>

@code {
    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    [Parameter]
    public double SampleMS { get; set; } = 100;

    public bool ServiceInitialized => _initialized && _initializedAsync;

    private IDisposable? _serviceDisposable;
    private bool _initialized = false;
    private bool _initializedAsync = false;

    protected override void OnInitialized()
    {
        base.OnInitialized();
        _serviceDisposable = Service.Subscribe(InvokeStateChanged, SampleMS);
    }

    protected override void OnAfterRender(bool firstRender)
    {
        base.OnAfterRender(firstRender);

        if (firstRender)
        {
            Service.OnInitialized();
            _initialized = true;
        }
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        await base.OnAfterRenderAsync(firstRender);

        if (firstRender)
        {
            await Service.OnInitializedAsync();
            _initializedAsync = true;
            Service.StateHasChanged(ServiceState.SERVICE);
        }
    }

    protected override void Dispose(bool disposing)
    {
        if (disposing)
        {
            _serviceDisposable?.Dispose();
        }

        base.Dispose(disposing);
    }

    private void InvokeStateChanged()
    {
        InvokeAsync(StateHasChanged);
    }
}
